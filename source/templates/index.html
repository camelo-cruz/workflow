<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Transcription App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container">
    <div class="sidebar"> 
        <h2 class="title">Automatic workflow LeibnizDream</h2>
        <form id="form-transcribe">

            <label for="action">Action</label>
            <select id="action" name="action" required>
              <option value="transcribe">Transcribe</option>
              <option value="translate">Translate</option>
              <option value="gloss">Gloss</option>
            </select>

            <label>Directory Path</label>
            <input type="text" id="base-dir" name="base_dir" placeholder="/path/to/dir" required>

            <label for="instruction">Instruction</label>
            <select id="instruction" name="instruction" required>
              <option value="automatic">automatic</option>
              <option value="corrected">corrected</option>
              <option value="sentences">sentences</option>
            </select>

            <label>Language</label>
            <input type="text" id="language" name="language" value="German" required>

            <button id="btn-process" class="btn-primary" type="button">Process</button>

            <div id="status" class="status"></div>
        </form>
    </div>

    <div class="main">
        <img src="{{ url_for('static', filename='zas_logo.jpg') }}" alt="Logo" class="logo">
        <p class="logo-text">LeibnizDream</p>

        <pre id="logs"></pre>
    </div>
</div>

<script>
document.getElementById("btn-process").onclick = async () => {
    const base = document.getElementById("base-dir").value.trim();
    const language = document.getElementById("language").value.trim();
    const action = document.getElementById("action").value.trim();
    const instruction = document.getElementById("instruction").value.trim();


    const payload = new FormData();
    payload.append("base_dir", base);
    payload.append("language", language);
    payload.append("action", action);
    payload.append("instruction", instruction);  // if needed later

    const res = await fetch("/process", { method: "POST", body: payload });
    const { job_id, error } = await res.json();
    const statusEl = document.getElementById("status");
    const logEl = document.getElementById("logs");
    logEl.textContent = "";

    if (error) {
        statusEl.textContent = error;
        return;
    }
    statusEl.textContent = "Job " + job_id + " started";

    const evt = new EventSource(`/logs/${job_id}`);
    evt.onmessage = e => {
        logEl.textContent += e.data + "\n";
        logEl.scrollTop = logEl.scrollHeight;
        if (e.data === "[DONE]" || e.data.startsWith("[ERROR]")) {
            evt.close();
            statusEl.textContent = "Finished";
        }
    };
};
</script>
</body>
</html>